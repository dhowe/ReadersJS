<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8">
  <title>The Readers Project</title>

  <script type="text/javascript">
    var timerStart = Date.now();
  </script>

  <link rel="stylesheet" href="fonts/webfont/font.css">
  <link rel="stylesheet" href="style.css">

  <script>
    window.onload = function ()
    {
      var menu = document.getElementById('interface'),
        overlay = document.getElementById('overlay');

      function monitor(element, callback)
      {
        var self = element;
        var h = self.clientHeight;
        var w = self.clientWidth;
        var txt = self.innerText;
        var html = self.innerHTML;
        (function flux()
        {
          setTimeout(function ()
          {
            var done = h === self.clientHeight &&
              w === self.clientWidth &&
              txt === self.innerText &&
              html === self.innerHTML;
            if (done)
            {
              callback();
            }
            else
            {
              h = self.clientHeight;
              w = self.clientWidth;
              txt = self.innerText;
              html = self.innerHTML;
              flux();
            }
          }, 250);
        })()
      };

      monitor(menu, function ()
      {
        // fadeout overlay
        overlay.classList.toggle('fade', setTimeout(function ()
        {
          // overlay.style.display = "none";
          var time = Date.now() - timerStart - 2000;
          console.log('[LOAD] ' + TEXTS[0].title + ' ' + time + 'ms');
          reloadTheRest();

        }, 2000));
      });
    }

    var textLoaded = ["Misspelt Landings"],
      notify;

    function finishLoading(text)
    {

      textLoaded.push(text);
      var time = Date.now() - timerStart;
      console.log('[LOAD] ' + text + ' ' + time + 'ms');

      if (overlay.classList.value === "" && notify === text)
      {
        overlay.classList.toggle('fade');
        textChanged();
        // TODO: call textChanged here
      }

    }

    function reloadTheRest()
    {

      var trigramScripts = {
        'Poetic Caption': "data/poeticCaption-trigrams.js",
        'The Image': "data/theImage-trigrams.js"
      }

      for (key in trigramScripts)
      {
        var script = document.createElement("script"),
          html = document.getElementsByTagName("html")[0];

        script.src = trigramScripts[key];
        script.id = key;

        html.appendChild(script);
        script.onload = function ()
        {
          finishLoading(this.id);
        };
      }

    }
  </script>

</head>

<body>
  <!-- Top Text Section -->
  <p id="instructions">Use left/right arrow-keys to change pages</p>
  <div id="options">Readers <span>Options</span></div>
  <div class="tag">Under Construction</div>

  <!-- Overlay -->
  <div id="overlay">
    <div id="loader"></div>
    <p>Loading</p>
  </div>

  <!-- Interface -->
  <div id="interface"></div>
  <div id="hoverTextWrapper">
    <!-- <div id="hoverText-unchecked" class="hoverText">click to enable</div> -->
    <div id="hoverText-checked" class="hoverText">
      click to disable/enable<span>, double-click for focus <a class="help">[?]</a></span>
      <span class="helpInfo">The 'focused' reader is always visible and able to display the text that it is reading. The words it has read recently are monitored separately on the right.</span>
    </div>
  </div>

  <!-- Focused Reader Display -->
  <div id="focusDisplay"></div>

</body>

<script src="node_modules/p5/lib/p5.js"></script>
<script src="node_modules/p5/lib/addons/p5.dom.js"></script>
<script src="node_modules/jquery/dist/jquery.slim.min.js"></script>
<script src="node_modules/rita/lib/rita-tiny.js"></script>

<script src="lib/rt.js"></script>
<script src="src/readers-app.js"></script>
<script src="src/mesostic-reader.js"></script>
<script src="src/perigram-reader.js"></script>
<script src="src/oblique-perigram-reader.js"></script>
<script src="data/misspeltLandings-trigrams.js"></script>
<script src="multi-page.js"></script>
<script src="multi-page-ui.js"></script>
</script>
<!-- <script src="data/poeticCaption-trigrams.js"  defer onload="finishLoading('poeticCaption')"></script>
<script src="data/theImage-trigrams.js"  defer onload="finishLoading('theImage')"></script> -->

</html>
